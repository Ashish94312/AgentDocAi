# Railway Deployment Guide for RepoDoc-AI

## Overview

This guide will help you deploy your RepoDoc-AI application on Railway with full MCP server support. Railway's free tier supports custom binaries, making it perfect for running the GitHub MCP server.

## Prerequisites

1. **GitHub Repository**: Your code should be pushed to a GitHub repository
2. **Railway Account**: Sign up at [railway.app](https://railway.app)
3. **API Keys**: You'll need:
   - GitHub Personal Access Token
   - OpenAI API Key

## Deployment Steps

### 1. Push Your Code to GitHub

```bash
git add .
git commit -m "Prepare for Railway deployment with MCP server"
git push origin main
```

### 2. Create Railway Account and Connect GitHub

1. Go to [railway.app](https://railway.app) and sign up
2. Connect your GitHub account
3. Click "New Project" ‚Üí "Deploy from GitHub repo"
4. Select your repository

### 3. Choose Deployment Method

You have two options for deployment:

#### Option A: Docker Deployment (Recommended)
- Uses `railway-docker.json` configuration
- More reliable and faster builds
- Better caching and optimization

#### Option B: NIXPACKS Deployment
- Uses `railway-nixpacks.json` configuration  
- Uses Railway's automatic build detection
- Good for simpler deployments

**For this guide, we'll use Docker deployment (Option A).**

### 4. Configure the Project

Railway will automatically detect your `railway-docker.json` configuration and use it.

### 4. Set Environment Variables

In your Railway project dashboard, go to the "Variables" tab and add:

```
DEBUG=False
SECRET_KEY=your-secret-key-here
ALLOWED_HOSTS=your-app-name.railway.app
GITHUB_PERSONAL_ACCESS_TOKEN=your_github_token_here
OPENAI_API_KEY=your_openai_api_key_here
PORT=10000
```

**Note:** 
- `SECRET_KEY` can be generated by Railway (check "Generate" option)
- Replace `your_github_token_here` and `your_openai_api_key_here` with your actual API keys
- `ALLOWED_HOSTS` should match your Railway app URL

### 5. Add Database (Optional)

If you need a database:

1. In Railway dashboard, click "New" ‚Üí "Database" ‚Üí "PostgreSQL"
2. Railway will automatically set the `DATABASE_URL` environment variable
3. Your Django app will automatically use it

### 6. Deploy

Railway will automatically:
1. Run the build script (`build_railway.sh`)
2. Build the GitHub MCP server
3. Set up the Python environment
4. Start the application with the start script (`start_railway.sh`)

## What Happens During Deployment

### Build Phase (`build_railway.sh`):
1. ‚úÖ Builds the GitHub MCP server using Go
2. ‚úÖ Creates Python virtual environment
3. ‚úÖ Installs all dependencies
4. ‚úÖ Collects Django static files

### Start Phase (`start_railway.sh`):
1. ‚úÖ Activates virtual environment
2. ‚úÖ Runs database migrations
3. ‚úÖ Collects static files
4. ‚úÖ Verifies MCP server is available
5. ‚úÖ Starts Gunicorn server

## Key Features

### ‚úÖ Full MCP Server Support
- GitHub MCP server is built and available
- All CrewAI tools work with MCP
- No fallback to GitHub API needed

### ‚úÖ Automatic Health Checks
- Health check endpoint at `/health/`
- Automatic restarts on failure
- Built-in monitoring

### ‚úÖ Environment Management
- Secure environment variable handling
- Automatic database connection
- Production-ready settings

## Monitoring and Logs

### View Logs
1. Go to your Railway project dashboard
2. Click on your service
3. Go to "Deployments" tab
4. Click on a deployment to see logs

### Health Check
Your app will be available at: `https://your-app-name.railway.app`

Health check endpoint: `https://your-app-name.railway.app/health/`

## Troubleshooting

### Common Issues

1. **Docker Build Fails with "go: no modules specified"**: 
   - This is fixed in the updated Dockerfile
   - The issue was copying go.mod/go.sum files in the wrong order
   - Use `Dockerfile.railway` for the corrected version

2. **Build Fails**: Check build logs for Go compilation errors
3. **MCP Server Not Found**: Verify Go is available during build
4. **Database Connection**: Ensure `DATABASE_URL` is set correctly
5. **Environment Variables**: Verify all required variables are set

### Debug Commands

You can run these commands in Railway's console:

```bash
# Check if MCP server exists
ls -la github-mcp-server/github-mcp-server

# Test MCP server
./github-mcp-server/github-mcp-server --help

# Check Django configuration
cd mcp_integration && python manage.py check
```

## Railway vs Render Comparison

| Feature | Railway | Render |
|---------|---------|--------|
| Free Tier | ‚úÖ Custom binaries | ‚ùå No custom binaries |
| MCP Server | ‚úÖ Full support | ‚ùå Not supported (free) |
| Database | ‚úÖ PostgreSQL included | ‚úÖ PostgreSQL included |
| Build Time | ‚úÖ Fast | ‚úÖ Fast |
| Custom Domains | ‚úÖ Supported | ‚úÖ Supported |

## Cost

- **Free Tier**: 500 hours/month, 1GB RAM, 1GB storage
- **Pro Plan**: $5/month for unlimited usage

## Next Steps

1. **Deploy**: Follow the steps above to deploy on Railway
2. **Test**: Verify the MCP server is working by checking logs
3. **Monitor**: Use Railway's dashboard to monitor your application
4. **Scale**: Upgrade to Pro plan if you need more resources

## Support

If you encounter issues:
1. Check Railway build/runtime logs
2. Verify environment variables
3. Test locally with Railway configuration
4. Check Railway documentation: [docs.railway.app](https://docs.railway.app)

## Success Indicators

Your deployment is successful when you see:
- ‚úÖ Build logs show "MCP server built successfully!"
- ‚úÖ Start logs show "MCP server found and ready!"
- ‚úÖ Health check returns 200 status
- ‚úÖ Application is accessible at your Railway URL

Your RepoDoc-AI application with full MCP server support is now live on Railway! üöÄ
